<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- WhatsApp Service Configuration -->
    <record id="catering_whatsapp_service_form_view" model="ir.ui.view">
        <field name="name">cater.whatsapp.service.form</field>
        <field name="model">cater.whatsapp.service</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group name="api_config">
                            <field name="api_url"/>
                            <field name="account_sid"/>
                            <field name="auth_token" password="True"/>
                            <field name="from_number"/>
                            <field name="messaging_service_sid"/>
                        </group>
                        <group name="status">
                            <field name="active"/>
                            <button name="action_test_connection" type="object" string="Test Connection" class="btn-primary"/>
                        </group>
                    </group>
                    
                    <div class="alert alert-info" role="alert">
                        <h4>Setup Instructions:</h4>
                        <ol>
                            <li>Create a Twilio account at https://www.twilio.com</li>
                            <li>Get your Account SID and Auth Token from the dashboard</li>
                            <li>Set up WhatsApp sandbox or get approved WhatsApp Business number</li>
                            <li>Enter your WhatsApp-enabled phone number in 'From Number'</li>
                        </ol>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <record id="catering_whatsapp_service_action" model="ir.actions.act_window">
        <field name="name">WhatsApp Configuration</field>
        <field name="res_model">cater.whatsapp.service</field>
        <field name="view_mode">form</field>
        <field name="res_id" ref="cater_whatsapp_service_default"/>
        <field name="target">current</field>
    </record>

    <record id="catering_whatsapp_service_list_view" model="ir.ui.view">
        <field name="name">cater.whatsapp.service.list</field>
        <field name="model">cater.whatsapp.service</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="active"/>
                <field name="from_number"/>
                <field name="messaging_service_sid"/>
            </list>
        </field>
    </record>

    <!-- WhatsApp Message Logs -->
    <record id="catering_whatsapp_log_list_view" model="ir.ui.view">
        <field name="name">cater.whatsapp.log.list</field>
        <field name="model">cater.whatsapp.log</field>
        <field name="arch" type="xml">
         <list decoration-success="status in ['sent','delivered','read']" 
            decoration-danger="status in ['failed','error']">
                <field name="send_date"/>
                <field name="to_number"/>
          <field name="status" widget="badge" 
              decoration-success="status in ['sent','delivered','read']"
              decoration-danger="status in ['failed','error']"/>
          <field name="message_sid"/>
                <field name="message"/>
                <field name="error_message"/>
            </list>
        </field>
    </record>

    <record id="catering_whatsapp_log_form_view" model="ir.ui.view">
        <field name="name">cater.whatsapp.log.form</field>
        <field name="model">cater.whatsapp.log</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <group>
                            <field name="to_number"/>
                            <field name="status"/>
                            <field name="message_sid"/>
                            <field name="send_date"/>
                        </group>
                    </group>
                    
                    <group string="Message">
                        <field name="message" nolabel="1"/>
                    </group>
                    
                    <group string="Response Data" invisible="response_data == False">
                        <field name="response_data" nolabel="1"/>
                    </group>
                    
                    <group string="Error Details" invisible="error_message == False">
                        <field name="error_message" nolabel="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="catering_whatsapp_log_action" model="ir.actions.act_window">
        <field name="name">WhatsApp Message Logs</field>
        <field name="res_model">cater.whatsapp.log</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_today': 1}</field>
    </record>
</odoo>
